(window.webpackJsonp=window.webpackJsonp||[]).push([[10],{236:function(t,e,n){"use strict";n.d(e,"c",(function(){return h})),n.d(e,"b",(function(){return f.a})),n.d(e,"e",(function(){return r})),n.d(e,"d",(function(){return d.a})),n.d(e,"a",(function(){return v}));var r,o=n(120),c=n(121),l=n(130),h=function(){function t(){Object(o.a)(this,t),this.size=10,this.opacity=1,this.pressureSizeWeight=1,this.pressureOpacityWeight=1,this.color=new l.Color}return Object(c.a)(t,[{key:"clone",value:function(){var e=new t;return e.size=this.size,e.opacity=this.opacity,e.pressureSizeWeight=this.pressureSizeWeight,e.pressureOpacityWeight=this.pressureOpacityWeight,e.color=new l.Color,e.color.r=this.color.r,e.color.g=this.color.g,e.color.b=this.color.b,e}}]),t}(),f=n(239);!function(t){t[t.Pencil=0]="Pencil",t[t.Eraser=1]="Eraser",t[t.Move=2]="Move",t[t.Pick=3]="Pick"}(r||(r={}));var d=n(240),v=function(){function t(){Object(o.a)(this,t),this.size=10,this.opacity=1,this.pressureSizeWeight=1,this.pressureOpacityWeight=1}return Object(c.a)(t,[{key:"clone",value:function(){var e=new t;return e.size=this.size,e.opacity=this.opacity,e.pressureSizeWeight=this.pressureSizeWeight,e.pressureOpacityWeight=this.pressureOpacityWeight,e}}]),t}()},239:function(t,e,n){"use strict";n.d(e,"a",(function(){return c}));var r=n(120),o=n(121),c=(n(38),function(){function t(){Object(r.a)(this,t),this.name="Layer",this.show=!1,this.opacity=1,this.children=[]}return Object(o.a)(t,[{key:"init",value:function(t,e){this.canvas=document.createElement("canvas"),t&&(this.canvas.width=t),e&&(this.canvas.height=e),this.ctx=this.canvas.getContext("2d"),this.ctx.clearRect(0,0,null!=t?t:this.canvas.width,null!=e?e:this.canvas.height),this.lastImageData=this.ctx.getImageData(0,0,null!=t?t:this.canvas.width,null!=e?e:this.canvas.height)}}]),t}())},240:function(t,e,n){"use strict";n.d(e,"a",(function(){return c}));var r=n(120),o=n(121),c=(n(38),n(31),function(){function t(){Object(r.a)(this,t),this.name="untitled",this.root={children:[]},this.width=512,this.height=512}return Object(o.a)(t,[{key:"resize",value:function(){var t=this;this.root.children.forEach((function(e){var n=e.ctx.getImageData(0,0,t.width,t.height);e.canvas.width=t.width,e.canvas.height=t.height,e.ctx.putImageData(n,0,0)}))}}]),t}())},243:function(t,e,n){"use strict";n.d(e,"b",(function(){return h})),n.d(e,"c",(function(){return d})),n.d(e,"a",(function(){return y}));var r=n(9),o=(n(48),n(38),n(50),n(71),n(31),n(246)),c=n(239),l=n(240);function h(t){return f.apply(this,arguments)}function f(){return(f=Object(r.a)(regeneratorRuntime.mark((function t(e){var n,r,h;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return(r=new l.a).name=e.name.replace(/\.psd$/,""),t.t0=o.readPsd,t.next=5,e.arrayBuffer();case 5:return t.t1=t.sent,(h=(0,t.t0)(t.t1)).imageResources={},null===(n=h.children)||void 0===n||n.forEach((function(t){if(t.canvas){var e=new c.a;e.name=t.name||"",e.canvas=t.canvas,e.ctx=t.canvas.getContext("2d"),r.root.children.push(e)}})),t.abrupt("return",r);case 10:case"end":return t.stop()}}),t)})))).apply(this,arguments)}function d(t){var canvas=document.createElement("canvas");canvas.width=t.width,canvas.height=t.height;var e=canvas.getContext("2d");return e.globalCompositeOperation="source-over",e.clearRect(0,0,t.width,t.height),t.root.children.forEach((function(t){e.globalAlpha=t.opacity,e.drawImage(t.canvas,0,0)})),canvas}var v=n(236);function y(){var t=new v.d,e=new v.b;e.name="Background",t.root.children.push(e),e.init(t.width,t.height);var n=new v.b;return n.name="Layer 1",n.init(t.width,t.height),t.root.children.push(n),e.ctx.fillStyle="white",e.ctx.fillRect(0,0,t.width,t.height),e.lastImageData=e.ctx.getImageData(0,0,t.width,t.height),t}},244:function(t,e,n){"use strict";n.d(e,"a",(function(){return c}));var r=n(120),o=n(121),c=(n(169),function(){function t(){Object(r.a)(this,t),this.undoStack=[],this.redoStack=[]}return Object(o.a)(t,[{key:"undoLength",get:function(){return this.undoStack.length}},{key:"redoLength",get:function(){return this.redoStack.length}},{key:"push",value:function(t){this.undoStack.push(t)}},{key:"pushRedo",value:function(t){this.redoStack.push(t)}},{key:"clearRedo",value:function(){this.redoStack=[]}},{key:"undo",value:function(){this.undoStack.length>0&&((0,this.undoStack[this.undoStack.length-1])(),this.undoStack.splice(this.undoStack.length-1,1))}},{key:"redo",value:function(){this.redoStack.length>0&&((0,this.redoStack[this.redoStack.length-1])(),this.redoStack.splice(this.redoStack.length-1,1))}}]),t}());c.main=new c},245:function(t,e,n){var content=n(263);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[t.i,content,""]]),content.locals&&(t.exports=content.locals);(0,n(24).default)("1919e340",content,!0,{sourceMap:!1})},254:function(t,e,n){var content=n(318);content.__esModule&&(content=content.default),"string"==typeof content&&(content=[[t.i,content,""]]),content.locals&&(t.exports=content.locals);(0,n(24).default)("2c709312",content,!0,{sourceMap:!1})},262:function(t,e,n){"use strict";n(245)},263:function(t,e,n){var r=n(23)(!1);r.push([t.i,".log[data-v-af365224]{left:0;top:0;position:absolute;pointer-events:none}",""]),t.exports=r},317:function(t,e,n){"use strict";n(254)},318:function(t,e,n){var r=n(23)(!1);r.push([t.i,".editor{height:100vh;max-height:-webkit-fill-available;min-width:100vw;overflow:hidden;-webkit-touch-callout:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;user-select:none}",""]),t.exports=r},320:function(t,e,n){"use strict";n(228);var r=n(120),o=n(121),c=n(230),l=n(231),h=n(229),f=n(30),d=(n(61),n(43),n(38),n(275),n(22),n(277),n(283),n(285),n(286),n(287),n(290),n(291),n(292),n(293),n(294),n(295),n(296),n(297),n(299),n(300),n(301),n(302),n(303),n(304),n(305),n(306),n(311),n(312),n(313),n(1)),v=n(0),y=n(246);n(35),n(44),n(172);var j=n(243);function O(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=Object(h.a)(t);if(e){var o=Object(h.a)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var m=function(t,e,n,desc){var r,o=arguments.length,c=o<3?e:null===desc?desc=Object.getOwnPropertyDescriptor(e,n):desc;if("object"===("undefined"==typeof Reflect?"undefined":Object(f.a)(Reflect))&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,n,desc);else for(var i=t.length-1;i>=0;i--)(r=t[i])&&(c=(o<3?r(c):o>3?r(e,n,c):r(e,n))||c);return o>3&&c&&Object.defineProperty(e,n,c),c},x=function(t){Object(c.a)(n,t);var e=O(n);function n(){var t;return Object(r.a)(this,n),(t=e.apply(this,arguments)).isOpen=!1,t}return Object(o.a)(n,[{key:"open",value:function(){this.isOpen=!0}},{key:"close",value:function(){this.isOpen=!1}},{key:"download",value:function(){var t,e,link,n={width:this.project.width,height:this.project.height,children:this.project.root.children.map((function(t){return{name:t.name,opacity:t.opacity,canvas:t.canvas}})),canvas:Object(j.c)(this.project)},r=Object(y.writePsd)(n);t=new Blob([new Uint8Array(r)]),e=this.project.name+".psd",(link=document.createElement("a")).href&&URL.revokeObjectURL(link.href),link.href=URL.createObjectURL(t),link.download=e,link.dispatchEvent(new MouseEvent("click"))}}]),n}(d.a);m([Object(v.b)()],x.prototype,"project",void 0);var w=x=m([Object(v.a)({})],x),k=n(37),component=Object(k.a)(w,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("sp-dialog",{attrs:{dismissable:!0,isOpen:t.isOpen,header:"Download PSD File"},on:{close:function(e){t.isOpen=!1}}},[n("sp-button",{on:{click:t.download}},[t._v("Download")])],1)}),[],!1,null,null,null);e.a=component.exports},322:function(t,e,n){"use strict";n(228);var r=n(120),o=n(121),c=n(230),l=n(231),h=n(229),f=n(30),d=(n(61),n(38),n(1)),v=n(0),y=n(264);function j(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=Object(h.a)(t);if(e){var o=Object(h.a)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var O=function(t,e,n,desc){var r,o=arguments.length,c=o<3?e:null===desc?desc=Object.getOwnPropertyDescriptor(e,n):desc;if("object"===("undefined"==typeof Reflect?"undefined":Object(f.a)(Reflect))&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,n,desc);else for(var i=t.length-1;i>=0;i--)(r=t[i])&&(c=(o<3?r(c):o>3?r(e,n,c):r(e,n))||c);return o>3&&c&&Object.defineProperty(e,n,c),c},m=function(t){Object(c.a)(n,t);var e=j(n);function n(){var t;return Object(r.a)(this,n),(t=e.apply(this,arguments)).isOpenSettings=!1,t.width=0,t.height=0,t.name="",t.version=y.version,t}return Object(o.a)(n,[{key:"open",value:function(){this.isOpenSettings=!0,this.width=this.project.width,this.height=this.project.height,this.name=this.project.name}},{key:"close",value:function(){this.isOpenSettings=!1}},{key:"save",value:function(){this.project.width=this.width,this.project.height=this.height,this.project.name=this.name,this.project.resize(),this.isOpenSettings=!1}}]),n}(d.a);O([Object(v.c)("projectSync")],m.prototype,"project",void 0);var x=m=O([Object(v.a)({})],m),w=n(37),component=Object(w.a)(x,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("sp-dialog",{attrs:{isOpen:t.isOpenSettings,header:"Settings"},on:{close:function(e){t.isOpenSettings=!1}},scopedSlots:t._u([{key:"footer",fn:function(){return[n("sp-button-group",{attrs:{dialog:!0}},[n("sp-button",{attrs:{type:"primary",group:!0},on:{click:t.close}},[t._v("\n        Cancel\n      ")]),t._v(" "),n("sp-button",{attrs:{group:!0},on:{click:t.save}},[t._v("Save")])],1)]},proxy:!0}])},[n("sp-field-label",[t._v("Name")]),t._v(" "),n("sp-textfield",{model:{value:t.name,callback:function(e){t.name=e},expression:"name"}}),t._v(" "),n("div",{staticStyle:{display:"flex",width:"256px"}},[n("div",{staticStyle:{width:"auto"}},[n("sp-field-label",[t._v("Width")]),t._v(" "),n("sp-textfield",{staticStyle:{width:"auto"},model:{value:t.width,callback:function(e){t.width=e},expression:"width"}})],1),t._v(" "),n("div",{staticStyle:{width:"auto"}},[n("sp-field-label",[t._v("Height")]),t._v(" "),n("sp-textfield",{staticStyle:{width:"auto"},model:{value:t.height,callback:function(e){t.height=e},expression:"height"}})],1)]),t._v(" "),n("sp-divider"),t._v(" "),n("h4",[t._v("App Info")]),t._v(" "),n("div",[t._v("Version: "+t._s(t.version))]),t._v(" "),n("sp-link",{attrs:{href:"https://github.com/toshusai/mira"}},[t._v("GitHub")]),t._v(" "),n("sp-divider")],1)}),[],!1,null,null,null);e.a=component.exports},323:function(t,e,n){"use strict";n(228);var r=n(9),o=n(120),c=n(121),l=n(230),h=n(231),f=n(229),d=n(30),v=(n(48),n(61),n(1)),y=n(0),j=n(243);function O(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=Object(f.a)(t);if(e){var o=Object(f.a)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Object(h.a)(this,n)}}var m=function(t,e,n,desc){var r,o=arguments.length,c=o<3?e:null===desc?desc=Object.getOwnPropertyDescriptor(e,n):desc;if("object"===("undefined"==typeof Reflect?"undefined":Object(d.a)(Reflect))&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,n,desc);else for(var i=t.length-1;i>=0;i--)(r=t[i])&&(c=(o<3?r(c):o>3?r(e,n,c):r(e,n))||c);return o>3&&c&&Object.defineProperty(e,n,c),c},x=function(t){Object(l.a)(f,t);var e,n,h=O(f);function f(){var t;return Object(o.a)(this,f),(t=h.apply(this,arguments)).isOpen=!1,t.dragOver=!1,t.errorMessage="Error",t}return Object(c.a)(f,[{key:"open",value:function(){this.isOpen=!0}},{key:"openFile",value:function(){this.input.click()}},{key:"error",value:function(t){this.errorMessage=t,this.toast.open(3e3)}},{key:"changeFile",value:(n=Object(r.a)(regeneratorRuntime.mark((function t(e){var n,r;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!(n=e.target).files||1!=n.files.length){t.next=18;break}if(t.prev=2,"image/vnd.adobe.photoshop"==(r=n.files[0]).type){t.next=7;break}return this.error("Unsuppoted file type ".concat(r.type)),t.abrupt("return");case 7:return t.next=9,Object(j.b)(r);case 9:this.project=t.sent,this.isOpen=!1,t.next=16;break;case 13:t.prev=13,t.t0=t.catch(2),this.error("Unexpected Error");case 16:t.next=19;break;case 18:this.error("Support only single file.");case 19:case"end":return t.stop()}}),t,this,[[2,13]])}))),function(t){return n.apply(this,arguments)})},{key:"dragover",value:function(t){this.dragOver=!0,t.preventDefault()}},{key:"dragleave",value:function(){this.dragOver=!1}},{key:"close",value:function(){this.isOpen=!1}},{key:"drop",value:(e=Object(r.a)(regeneratorRuntime.mark((function t(e){var n,r,o;return regeneratorRuntime.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(e.preventDefault(),!(r=null===(n=e.dataTransfer)||void 0===n?void 0:n.files)||1!=r.length){t.next=10;break}return o=r[0],t.next=6,Object(j.b)(o);case 6:this.project=t.sent,this.isOpen=!1,t.next=11;break;case 10:this.error("Support only single file.");case 11:case"end":return t.stop()}}),t,this)}))),function(t){return e.apply(this,arguments)})}]),f}(v.a);m([Object(y.c)("projectSync")],x.prototype,"project",void 0),m([Object(y.d)()],x.prototype,"input",void 0),m([Object(y.d)()],x.prototype,"toast",void 0);var w=x=m([Object(y.a)({})],x),k=n(37),component=Object(k.a)(w,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("sp-dialog",{attrs:{dismissable:!0,isOpen:t.isOpen,header:"Open PSD File"},on:{close:function(e){t.isOpen=!1}}},[n("div",{on:{drop:t.drop,dragover:t.dragover,dragleave:t.dragleave}},[n("sp-dropzone",{attrs:{dragged:t.dragOver}},[n("sp-button",{staticStyle:{"margin-top":"32px"},attrs:{type:"primary"},on:{click:t.openFile}},[t._v("\n        Select a File\n        "),n("input",{ref:"input",staticStyle:{display:"none"},attrs:{type:"file"},on:{change:t.changeFile}})])],1)],1),t._v(" "),n("sp-toast",{ref:"toast",attrs:{negative:!0}},[t._v("\n    "+t._s(t.errorMessage)+"\n  ")])],1)}),[],!1,null,null,null);e.a=component.exports},326:function(t,e,n){"use strict";n.r(e);n(228);var r=n(120),o=n(121),c=n(230),l=n(231),h=n(229),f=n(30),d=(n(61),n(1)),v=n(0),y=n(257),j=n.n(y),O=(n(258),n(91),n(31),n(261),n(169),function t(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:0,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,o=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;Object(r.a)(this,t),this.x=e,this.y=n,this.z=o});function m(element,t,e){var n,r,o,rect=element.getBoundingClientRect(),c=rect.left,l=rect.top;if(e instanceof TouchEvent&&e.touches&&e.touches[0]&&void 0!==e.touches[0].force){if("stylus"!=e.touches[0].touchType)return{x:n,y:r,z:o};e.touches[0].force>0&&(o=e.touches[0].force),n=(e.touches[0].pageX-c)/t,r=(e.touches[0].pageY-l)/t}else e instanceof MouseEvent&&(o=1,n=(e.pageX-c)/t,r=(e.pageY-l)/t);return new O(n,r,o)}function x(a,b){return Math.sqrt(Math.pow(b.x-a.x,2)+Math.pow(b.y-a.y,2))}function w(a,b){return Math.atan2(b.x-a.x,b.y-a.y)}var k=n(236),S=n(244);function R(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=Object(h.a)(t);if(e){var o=Object(h.a)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var _=function(t,e,n,desc){var r,o=arguments.length,c=o<3?e:null===desc?desc=Object.getOwnPropertyDescriptor(e,n):desc;if("object"===("undefined"==typeof Reflect?"undefined":Object(f.a)(Reflect))&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,n,desc);else for(var i=t.length-1;i>=0;i--)(r=t[i])&&(c=(o<3?r(c):o>3?r(e,n,c):r(e,n))||c);return o>3&&c&&Object.defineProperty(e,n,c),c},P=function(t){Object(c.a)(n,t);var e=R(n);function n(){var t;return Object(r.a)(this,n),(t=e.apply(this,arguments)).pageTop=0,t.pageLeft=0,t.scale=1,t.pos={x:100,y:100},t.base={x:0,y:0},t.baseScale=1,t.pinching=!1,t.prevTouchList=null,t.logs=[],t.isMousedown=!1,t.prevD=Number.NaN,t.doneFP=!1,t.tempCtx=null,t.prevPoint=null,t.stroke=[],t.history=[],t}return Object(o.a)(n,[{key:"width",get:function(){return this.project.width}},{key:"height",get:function(){return this.project.height}},{key:"ctx",get:function(){return this.tempCtx?this.tempCtx:this.currentLayer?this.currentLayer.ctx:void 0}},{key:"canvas",get:function(){if(this.currentLayer)return this.currentLayer.canvas}},{key:"style",get:function(){var t=this.pos.x,e=this.scale;return this.flipH&&(t=this.pos.x+this.width*this.scale,e=-e),{transform:"translate(".concat(t,"px, ").concat(this.pos.y,"px) scale(").concat(e,", ").concat(Math.abs(e),")"),transformOrigin:"top left",width:this.width+"px",height:this.height+"px"}}},{key:"vlogs",get:function(){return this.logs.reverse()}},{key:"init",value:function(){this.currentLayer&&this.layers.forEach((function(t){var img=t.ctx.getImageData(0,0,512,512);t.ctx.putImageData(img,0,0)}))}},{key:"renderCanvas",value:function(){var t=this;this.canvasElCtx.globalCompositeOperation="source-over",this.canvasElCtx.clearRect(0,0,this.width,this.height),this.layers.forEach((function(e){t.canvasElCtx.globalAlpha=e.opacity,t.canvasElCtx.drawImage(e.canvas,0,0)}))}},{key:"mounted",value:function(){var t=this;this.canvasElCtx=this.canvasEl.getContext("2d"),this.clear();var e=this.$el;e.addEventListener("mousedown",this.start),e.addEventListener("touchstart",this.start,{passive:!1}),e.addEventListener("mousemove",this.move),e.addEventListener("touchmove",this.move,{passive:!1}),e.addEventListener("mouseup",this.end),e.addEventListener("touchend",this.end,{passive:!1}),this.resize(),this.init(),this.$nextTick((function(){return t.init()})),this.renderCanvas(),this._pencil=this.pencil,this._eraser=this.eraser}},{key:"clear",value:function(){this.ctx&&(this.ctx.fillStyle="#ffffff",this.ctx.fillRect(0,0,this.width,this.height))}},{key:"resize",value:function(){if(this.canvasEl){var rect=this.canvasEl.getBoundingClientRect();this.pageTop=rect.top,this.pageLeft=rect.left}}},{key:"drawPoint",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(this.ctx){this.ctx.strokeStyle=this._pencil.color.toHex(),this.ctx.fillStyle=this._pencil.color.toHex(),this.ctx.globalCompositeOperation="source-over",this.tool==k.e.Eraser&&(this.ctx.globalCompositeOperation="destination-out");var n=this._pencil;if(this.tool==k.e.Eraser&&(n=this._eraser),this.ctx.lineWidth=0,null==this.prevPoint){var p=t;this.ctx.beginPath();var r=n.size*p.z;this.ctx.arc(p.x,p.y,r/2,0,2*Math.PI,!1),this.ctx.fill(),this.ctx.stroke()}else for(var o=this.prevPoint,c=t,l=x(c,o),a=w(c,o),i=0;i<l;i+=.5){var h=i/l;h<=.1&&(h=0),h>=1&&(h=1),c.z<.1&&(c.z=.1);var f=function(a,b,t){return a*(1-t)+b*t},d=n.size*f(1,o.z,n.pressureSizeWeight),v=n.size*f(1,c.z,n.pressureSizeWeight),y=f(v,d,h);this.ctx.globalAlpha=n.opacity*f(1,c.z,n.pressureOpacityWeight),this.ctx.beginPath(),this.ctx.arc(c.x+Math.sin(a)*i,c.y+Math.cos(a)*i,y/2,0,2*Math.PI,!1),this.ctx.closePath(),this.ctx.fill(),this.ctx.stroke()}this.stroke.push(t),this.prevPoint=t,e||this.renderCanvas()}}},{key:"handle",value:function(t){if(t instanceof TouchEvent&&2==t.touches.length){if(!this.doneFP)return this.doneFP=!0,this.prevD=Number.NaN,void(this.pinching=!0);var a=t.touches[0],b=t.touches[1],e={x:a.pageX,y:a.pageY},n={x:b.pageX,y:b.pageY},r={x:(e.x+n.x)/2,y:(e.y+n.y)/2},o={x:r.x-this.pageLeft,y:r.y-this.pageTop};o.x/=this.width*this.scale,o.y/=this.height*this.scale;var c=Math.sqrt(Math.pow(e.x-n.x,2)+Math.pow(e.y-n.y,2));if(!isNaN(this.prevD)){var l=c/this.prevD;this.zoom(l,o)}this.resize(),this.prevD=c}}},{key:"zoom",value:function(t,e){var n=this.scale;this.scale*=t;var r=-this.scale+n;this.pos.x+=this.width*e.x*r,this.pos.y+=this.height*e.y*r}},{key:"start",value:function(t){if(t instanceof TouchEvent&&t.touches.length>0&&(this.base.x=t.touches[0].pageX,this.base.y=t.touches[0].pageY),this.doneFP=!1,this.isMousedown=!0,!this.isFingerTouch(t)){var p=m(this.canvasEl,this.scale,t);this.flipH&&(p.x=this.width-p.x),this.drawPoint(p)}t instanceof TouchEvent&&(this.prevTouchList=t.touches),this.renderCanvas(),t.preventDefault()}},{key:"move",value:function(t){var e;if(t instanceof TouchEvent&&t.touches[0]&&"stylus"!=t.touches[0].touchType&&(1==t.touches.length&&1==(null===(e=this.prevTouchList)||void 0===e?void 0:e.length)&&(this.pos.x+=t.touches[0].pageX-this.base.x,this.pos.y+=t.touches[0].pageY-this.base.y,this.base.x=t.touches[0].pageX,this.base.y=t.touches[0].pageY,this.resize()),1==t.touches.length&&(this.base.x=t.touches[0].pageX,this.base.y=t.touches[0].pageY)),this.handle(t),this.isMousedown){if(!this.isFingerTouch(t)){var p=m(this.canvasEl,this.scale,t);this.flipH&&(p.x=this.width-p.x),t instanceof TouchEvent&&(this.prevTouchList=t.touches),this.drawPoint(p)}t.preventDefault()}}},{key:"isFingerTouch",value:function(t){return t instanceof TouchEvent&&t.touches.length>0&&"stylus"!=t.touches[0].touchType}},{key:"end",value:function(t){var e=this;if(this.handle(t),this.pinching=!1,!(this.prevTouchList&&this.prevTouchList.length>0&&"direct"==this.prevTouchList[0].touchType)&&this.stroke.length>0){if(!this.currentLayer)return;this.history.push({layer:this.currentLayer,stroke:this.stroke,tool:this.tool,pencil:this.pencil.clone(),eraser:this.eraser.clone()}),this.$store.commit("setRedo",!1),S.a.main.clearRedo();S.a.main.push((function t(){e.layers.forEach((function(t){t.ctx.putImageData(t.lastImageData,0,0)}));var n=e.history.splice(e.history.length-1,1);e.drawStrokes(e.history),S.a.main.pushRedo((function(){n.length>0&&(e.layers.forEach((function(t){t.ctx.putImageData(t.lastImageData,0,0)})),e.history.push(n[0]),e.drawStrokes(e.history),S.a.main.push(t),e.$store.commit("setUndo",!0))})),e.$store.commit("setRedo",!0)})),this.$store.commit("setUndo",!0)}this.stroke=[],this.prevPoint=null,this.isMousedown=!1,this.renderCanvas(),t.preventDefault()}},{key:"drawStrokes",value:function(t){if(this.currentLayer){for(var e=this.tool,n=this.pencil,r=this.eraser,i=0;i<t.length;i++){var o=t[i];this.tempCtx=o.layer.ctx,this.prevPoint=null,this.tool=o.tool,this._pencil=o.pencil,this._eraser=o.eraser;for(var c=0;c<o.stroke.length;c++){var l=o.stroke[c];this.drawPoint(l,!0)}this.stroke=[],this.prevPoint=null}this.renderCanvas(),this.tempCtx=null,this.tool=e,this._pencil=n,this._eraser=r}}}]),n}(d.a);_([Object(v.c)("pencilSync",{default:function(){return new k.c}})],P.prototype,"pencil",void 0),_([Object(v.c)("eraserSync",{default:function(){return new k.a}})],P.prototype,"eraser",void 0),_([Object(v.c)("toolSync",{default:k.e.Pencil})],P.prototype,"tool",void 0),_([Object(v.b)({default:function(){return[]}})],P.prototype,"layers",void 0),_([Object(v.b)({default:null})],P.prototype,"currentLayer",void 0),_([Object(v.b)({default:!1})],P.prototype,"flipH",void 0),_([Object(v.b)()],P.prototype,"project",void 0),_([Object(v.d)()],P.prototype,"canvasEl",void 0),_([Object(v.f)("currentLayer")],P.prototype,"init",null),_([Object(v.f)("layers")],P.prototype,"renderCanvas",null);var L=P=_([Object(v.a)({components:{}})],P),E=(n(262),n(37)),C=Object(E.a)(L,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("div",{staticStyle:{height:"100vh"}},[n("div",{staticClass:"alpha-background",style:t.style},[n("canvas",{ref:"canvasEl",attrs:{width:t.width,height:t.height}})]),t._v(" "),n("div",{staticClass:"log"},t._l(t.vlogs,(function(e,i){return n("div",{key:i},[t._v(t._s(e))])})),0)])}),[],!1,null,"af365224",null).exports,z=n(321),B=n(319);n(314);function T(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=Object(h.a)(t);if(e){var o=Object(h.a)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var D=function(t,e,n,desc){var r,o=arguments.length,c=o<3?e:null===desc?desc=Object.getOwnPropertyDescriptor(e,n):desc;if("object"===("undefined"==typeof Reflect?"undefined":Object(f.a)(Reflect))&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,n,desc);else for(var i=t.length-1;i>=0;i--)(r=t[i])&&(c=(o<3?r(c):o>3?r(e,n,c):r(e,n))||c);return o>3&&c&&Object.defineProperty(e,n,c),c},M=function(t){Object(c.a)(n,t);var e=T(n);function n(){return Object(r.a)(this,n),e.apply(this,arguments)}return Object(o.a)(n,[{key:"selectLayer",value:function(t){this.selectedLayer=t}},{key:"updateEmit",value:function(){this.$emit("update")}},{key:"deleteLayer",value:function(){var t=this,i=this.project.root.children.findIndex((function(e){return e==t.selectedLayer}));-1!=i&&(this.project.root.children.splice(i,1),0==this.project.root.children.length?this.selectedLayer=null:this.project.root.children[i-1]?this.selectedLayer=this.project.root.children[i-1]:this.project.root.children[i]?this.selectedLayer=this.project.root.children[i]:this.selectedLayer=this.project.root.children[0])}},{key:"addLayer",value:function(){var t=new k.b;t.init(this.project.width,this.project.height),t.canvas.width=this.project.width,t.canvas.height=this.project.height,this.project.root.children.push(t),this.selectedLayer=t}},{key:"move",value:function(p){var i=p.i,t=this.project.root.children;if(t[i]!=p.item){var e=t.findIndex((function(t){return t==p.item}));-1!=e&&t.splice(e,1);var n=-1;e>i&&(n=0),t.splice(i+n,0,p.item)}}}]),n}(d.a);D([Object(v.b)()],M.prototype,"treeWidth",void 0),D([Object(v.c)("projectSync")],M.prototype,"project",void 0),D([Object(v.c)("selectedLayerS")],M.prototype,"selectedLayer",void 0);var W=M=D([Object(v.a)({})],M),I=Object(E.a)(W,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("sp-split-view-pane",{staticClass:"prevent-touchmove",style:"width: "+t.treeWidth+"px; min-width: "+t.treeWidth+"px; max-width: "+t.treeWidth+"px"},[n("sp-action-group",{attrs:{compact:!0,quiet:!0}},[n("sp-action-button",{attrs:{item:!0,quiet:!0},on:{click:t.addLayer}},[n("sp-icon",{attrs:{name:"Add"}})],1),t._v(" "),n("sp-action-button",{attrs:{item:!0,quiet:!0},on:{click:t.deleteLayer}},[n("sp-icon",{attrs:{name:"Delete"}})],1)],1),t._v(" "),n("sp-divider",{staticStyle:{margin:"0"}}),t._v(" "),t.selectedLayer?[n("sp-textfield",{staticStyle:{width:"calc(100% - 8px)",margin:"4px"},attrs:{size:"S"},model:{value:t.selectedLayer.name,callback:function(e){t.$set(t.selectedLayer,"name",e)},expression:"selectedLayer.name"}}),t._v(" "),n("sp-slider",{staticStyle:{margin:"0 8px"},attrs:{min:0,max:1,label:"Opacity",valueText:t.selectedLayer.opacity.toFixed(2)},on:{input:t.updateEmit},model:{value:t.selectedLayer.opacity,callback:function(e){t.$set(t.selectedLayer,"opacity",e)},expression:"selectedLayer.opacity"}})]:t._e(),t._v(" "),n("sp-divider",{staticStyle:{margin:"0"}}),t._v(" "),n("sp-item-list-item",{attrs:{selectedItem:t.selectedLayer,items:t.project.root.children},on:{pointerdown:t.selectLayer,move:t.move},scopedSlots:t._u([{key:"default",fn:function(e){var r=e.item;return[n("div",{staticStyle:{padding:"2px 0 2px 0"}},[t._v("\n        "+t._s(r.name)+"\n      ")])]}}])})],2)}),[],!1,null,null,null).exports,$=n(130),H=n(324),F=n(325);function N(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=Object(h.a)(t);if(e){var o=Object(h.a)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var U=function(t,e,n,desc){var r,o=arguments.length,c=o<3?e:null===desc?desc=Object.getOwnPropertyDescriptor(e,n):desc;if("object"===("undefined"==typeof Reflect?"undefined":Object(f.a)(Reflect))&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,n,desc);else for(var i=t.length-1;i>=0;i--)(r=t[i])&&(c=(o<3?r(c):o>3?r(e,n,c):r(e,n))||c);return o>3&&c&&Object.defineProperty(e,n,c),c},A=function(t){Object(c.a)(n,t);var e=N(n);function n(){var t;return Object(r.a)(this,n),(t=e.apply(this,arguments)).color1=new $.Color,t.color2=new $.Color,t.colorButtonIndex=0,t.selectedColor=1,t.Tool=k.e,t}return Object(o.a)(n,[{key:"mounted",value:function(){this.color2.r=255,this.color2.g=255,this.color2.b=255}},{key:"openPencilPop",value:function(){this.tool==k.e.Pencil&&this.pencilPopover.open(this.pencilButton.$el),this.tool=k.e.Pencil}},{key:"openEraserPop",value:function(){this.tool==k.e.Eraser&&this.eraserPopover.open(this.eraserButton.$el),this.tool=k.e.Eraser}},{key:"selectColor",value:function(t){this.colorButtonIndex=t,0==t?this.pencil.color=this.color1:1==t&&(this.pencil.color=this.color2)}},{key:"changeColor1",value:function(t){this.pencil.color=t}},{key:"changeColor2",value:function(t){this.pencil.color=t}}]),n}(d.a);U([Object(v.c)("projectSync")],A.prototype,"project",void 0),U([Object(v.c)("toolSync")],A.prototype,"tool",void 0),U([Object(v.c)("pencilSync")],A.prototype,"pencil",void 0),U([Object(v.c)("eraserSync")],A.prototype,"eraser",void 0),U([Object(v.d)()],A.prototype,"pencilPopover",void 0),U([Object(v.d)()],A.prototype,"eraserPopover",void 0),U([Object(v.d)()],A.prototype,"color1Button",void 0),U([Object(v.d)()],A.prototype,"color2Button",void 0),U([Object(v.d)()],A.prototype,"pencilButton",void 0),U([Object(v.d)()],A.prototype,"eraserButton",void 0);var X=A=U([Object(v.a)({components:{ColorButton:H.a,IPencilPopover:F.a}})],A),Y=Object(E.a)(X,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return n("sp-split-view-pane",{staticStyle:{padding:"4px"}},[n("sp-action-group",{attrs:{vertical:!0}},[n("sp-action-button",{ref:"pencilButton",attrs:{item:!0,quiet:!0,emphasized:t.tool==t.Tool.Pencil,selected:t.tool==t.Tool.Pencil,corner:!0},on:{pointerdown:t.openPencilPop}},[n("sp-icon",{attrs:{name:"Brush"}})],1),t._v(" "),n("sp-action-button",{ref:"eraserButton",attrs:{emphasized:t.tool==t.Tool.Eraser,selected:t.tool==t.Tool.Eraser,item:!0,quiet:!0,corner:!0},on:{pointerdown:t.openEraserPop}},[n("sp-icon",{attrs:{name:"Erase"}})],1),t._v(" "),n("sp-divider"),t._v(" "),n("color-button",{ref:"color1Button",attrs:{selected:0==t.colorButtonIndex,colorSync:t.color1},on:{"update:colorSync":function(e){t.color1=e},"update:color-sync":function(e){t.color1=e},change:t.changeColor1,pointerdown:function(e){return t.selectColor(0)}}}),t._v(" "),n("color-button",{ref:"color2Button",attrs:{selected:1==t.colorButtonIndex,colorSync:t.color2},on:{"update:colorSync":function(e){t.color2=e},"update:color-sync":function(e){t.color2=e},change:t.changeColor2,pointerdown:function(e){return t.selectColor(1)}}})],1),t._v(" "),n("i-pencil-popover",{ref:"pencilPopover",attrs:{ipencilSync:t.pencil,selected:t.tool==t.Tool.Pencil},on:{"update:ipencilSync":function(e){t.pencil=e},"update:ipencil-sync":function(e){t.pencil=e}}}),t._v(" "),n("i-pencil-popover",{ref:"eraserPopover",attrs:{ipencilSync:t.eraser,selected:t.tool==t.Tool.Eraser},on:{"update:ipencilSync":function(e){t.eraser=e},"update:ipencil-sync":function(e){t.eraser=e}}})],1)}),[],!1,null,null,null).exports;function J(t,e){return!!t.parentElement&&(t.tagName==e||J(t.parentElement,e))}var G=n(243);function V(t){var e=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(t){return!1}}();return function(){var n,r=Object(h.a)(t);if(e){var o=Object(h.a)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return Object(l.a)(this,n)}}var K=function(t,e,n,desc){var r,o=arguments.length,c=o<3?e:null===desc?desc=Object.getOwnPropertyDescriptor(e,n):desc;if("object"===("undefined"==typeof Reflect?"undefined":Object(f.a)(Reflect))&&"function"==typeof Reflect.decorate)c=Reflect.decorate(t,e,n,desc);else for(var i=t.length-1;i>=0;i--)(r=t[i])&&(c=(o<3?r(c):o>3?r(e,n,c):r(e,n))||c);return o>3&&c&&Object.defineProperty(e,n,c),c},Q=function(t){Object(c.a)(n,t);var e=V(n);function n(){var t;return Object(r.a)(this,n),(t=e.apply(this,arguments)).project=new k.d,t.tool=k.e.Pencil,t.Tool=k.e,t.treeWidth=200,t.selectedLayer=null,t.pencil=new k.c,t.eraser=new k.a,t.flipH=!1,t}return Object(o.a)(n,[{key:"clear",value:function(){this.canvas.clear()}},{key:"changeW",value:function(t){this.treeWidth-=t}},{key:"update",value:function(){this.canvas.renderCanvas()}},{key:"mounted",value:function(){j()("/mira/static/spectrum-css-icons.svg",(function(){})),j()("/mira/static/spectrum-icons.svg",(function(){})),this.project=Object(G.a)(),this.selectedLayer=this.project.root.children[0],document.body.addEventListener("touchmove",(function(t){J(t.target,"BUTTON")||t.preventDefault()}),{passive:!1})}}]),n}(d.a);K([Object(v.d)()],Q.prototype,"canvas",void 0);var Z=Q=K([Object(v.a)({components:{MiraCanvas:C,AppHeader:z.a,AppActionBar:B.a,LayerPanel:I,SideToolBar:Y}})],Q),tt=(n(317),Object(E.a)(Z,(function(){var t=this,e=t.$createElement,n=t._self._c||e;return t.project?n("div",{staticClass:"editor"},[n("sp-split-view",{attrs:{vertical:!0}},[n("app-header",{attrs:{projectSync:t.project},on:{"update:projectSync":function(e){t.project=e},"update:project-sync":function(e){t.project=e}}}),t._v(" "),n("sp-split-view-splitter"),t._v(" "),n("app-action-bar",{attrs:{flipHSync:t.flipH},on:{"update:flipHSync":function(e){t.flipH=e},"update:flip-h-sync":function(e){t.flipH=e}}}),t._v(" "),n("sp-split-view-splitter")],1),t._v(" "),n("sp-split-view",{staticStyle:{height:"calc(100vh - 68px)"}},[n("side-tool-bar",{attrs:{projectSync:t.project,toolSync:t.tool,pencilSync:t.pencil,eraserSync:t.eraser},on:{"update:projectSync":function(e){t.project=e},"update:project-sync":function(e){t.project=e},"update:toolSync":function(e){t.tool=e},"update:tool-sync":function(e){t.tool=e},"update:pencilSync":function(e){t.pencil=e},"update:pencil-sync":function(e){t.pencil=e},"update:eraserSync":function(e){t.eraser=e},"update:eraser-sync":function(e){t.eraser=e}}}),t._v(" "),n("sp-split-view-splitter",{staticStyle:{"min-width":"2px"}}),t._v(" "),n("sp-split-view-pane",{staticStyle:{overflow:"hidden",width:"10000px",height:"100%"}},[n("mira-canvas",{ref:"canvas",attrs:{pencilSync:t.pencil,toolSync:t.tool,eraserSync:t.eraser,currentLayer:t.selectedLayer,flipH:t.flipH,layers:t.project.root.children,project:t.project},on:{"update:pencilSync":function(e){t.pencil=e},"update:pencil-sync":function(e){t.pencil=e},"update:toolSync":function(e){t.tool=e},"update:tool-sync":function(e){t.tool=e},"update:eraserSync":function(e){t.eraser=e},"update:eraser-sync":function(e){t.eraser=e}}})],1),t._v(" "),n("sp-split-view-splitter",{staticStyle:{"min-width":"2px"}}),t._v(" "),n("layer-panel",{attrs:{projectSync:t.project,selectedLayerS:t.selectedLayer,treeWidth:t.treeWidth},on:{"update:projectSync":function(e){t.project=e},"update:project-sync":function(e){t.project=e},"update:selectedLayerS":function(e){t.selectedLayer=e},"update:selected-layer-s":function(e){t.selectedLayer=e},update:t.update}})],1)],1):t._e()}),[],!1,null,null,null));e.default=tt.exports}}]);